<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pelanggan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
  </head>
  <body>
    <div class="flex flex-row space-x-4 h-screen">
      <!-- NAVBAR -->
      <nav class="p-2 space-y-2 text-xs border-x-2">
        <div>
          <a
            href="/"
            class="flex items-center space-x-2 font-medium p-2 text-slate-700 rounded-lg hover:bg-red-500 hover:text-white"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-6 h-6"
            >
              <path
                d="M11.47 3.84a.75.75 0 011.06 0l8.69 8.69a.75.75 0 101.06-1.06l-8.689-8.69a2.25 2.25 0 00-3.182 0l-8.69 8.69a.75.75 0 001.061 1.06l8.69-8.69z"
              />
              <path
                d="M12 5.432l8.159 8.159c.03.03.06.058.091.086v6.198c0 1.035-.84 1.875-1.875 1.875H15a.75.75 0 01-.75-.75v-4.5a.75.75 0 00-.75-.75h-3a.75.75 0 00-.75.75V21a.75.75 0 01-.75.75H5.625a1.875 1.875 0 01-1.875-1.875v-6.198a2.29 2.29 0 00.091-.086L12 5.43z"
              />
            </svg>

            <div class="items-start pr-12">
              <caption>
                Dashboard
              </caption>
            </div>
          </a>
        </div>

        <div class="">
          <a
            href="/bengkel"
            class="flex items-center space-x-2 font-medium px-2 py-2 text-slate-700 rounded-lg hover:bg-red-500 hover:text-white"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-6 h-6"
            >
              <path
                d="M19.006 3.705a.75.75 0 00-.512-1.41L6 6.838V3a.75.75 0 00-.75-.75h-1.5A.75.75 0 003 3v4.93l-1.006.365a.75.75 0 00.512 1.41l16.5-6z"
              />
              <path
                fill-rule="evenodd"
                d="M3.019 11.115L18 5.667V9.09l4.006 1.456a.75.75 0 11-.512 1.41l-.494-.18v8.475h.75a.75.75 0 010 1.5H2.25a.75.75 0 010-1.5H3v-9.129l.019-.006zM18 20.25v-9.565l1.5.545v9.02H18zm-9-6a.75.75 0 00-.75.75v4.5c0 .414.336.75.75.75h3a.75.75 0 00.75-.75V15a.75.75 0 00-.75-.75H9z"
                clip-rule="evenodd"
              />
            </svg>

            <div class="items-center">
              <caption>
                Bengkel
              </caption>
            </div>
          </a>
        </div>

        <div>
          <a
            href="/layanan"
            class="flex items-center space-x-2 font-medium px-2 py-2 text-slate-700 rounded-lg hover:bg-red-500 hover:text-white"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-6 h-6"
            >
              <path
                fill-rule="evenodd"
                d="M12 6.75a5.25 5.25 0 016.775-5.025.75.75 0 01.313 1.248l-3.32 3.319c.063.475.276.934.641 1.299.365.365.824.578 1.3.64l3.318-3.319a.75.75 0 011.248.313 5.25 5.25 0 01-5.472 6.756c-1.018-.086-1.87.1-2.309.634L7.344 21.3A3.298 3.298 0 112.7 16.657l8.684-7.151c.533-.44.72-1.291.634-2.309A5.342 5.342 0 0112 6.75zM4.117 19.125a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75h-.008a.75.75 0 01-.75-.75v-.008z"
                clip-rule="evenodd"
              />
              <path
                d="M10.076 8.64l-2.201-2.2V4.874a.75.75 0 00-.364-.643l-3.75-2.25a.75.75 0 00-.916.113l-.75.75a.75.75 0 00-.113.916l2.25 3.75a.75.75 0 00.643.364h1.564l2.062 2.062 1.575-1.297z"
              />
              <path
                fill-rule="evenodd"
                d="M12.556 17.329l4.183 4.182a3.375 3.375 0 004.773-4.773l-3.306-3.305a6.803 6.803 0 01-1.53.043c-.394-.034-.682-.006-.867.042a.589.589 0 00-.167.063l-3.086 3.748zm3.414-1.36a.75.75 0 011.06 0l1.875 1.876a.75.75 0 11-1.06 1.06L15.97 17.03a.75.75 0 010-1.06z"
                clip-rule="evenodd"
              />
            </svg>

            <div class="items-start pr-12">
              <caption>
                Layanan
              </caption>
            </div>
          </a>
        </div>

        <div>
          <a
            href="/motor"
            class="flex items-center space-x-2 font-medium px-2 py-2 text-slate-700 rounded-lg hover:bg-red-500 hover:text-white"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-6 h-6"
            >
              <path
                d="M17.004 10.407c.138.435-.216.842-.672.842h-3.465a.75.75 0 01-.65-.375l-1.732-3c-.229-.396-.053-.907.393-1.004a5.252 5.252 0 016.126 3.537zM8.12 8.464c.307-.338.838-.235 1.066.16l1.732 3a.75.75 0 010 .75l-1.732 3.001c-.229.396-.76.498-1.067.16A5.231 5.231 0 016.75 12c0-1.362.519-2.603 1.37-3.536zM10.878 17.13c-.447-.097-.623-.608-.394-1.003l1.733-3.003a.75.75 0 01.65-.375h3.465c.457 0 .81.408.672.843a5.252 5.252 0 01-6.126 3.538z"
              />
              <path
                fill-rule="evenodd"
                d="M21 12.75a.75.75 0 000-1.5h-.783a8.22 8.22 0 00-.237-1.357l.734-.267a.75.75 0 10-.513-1.41l-.735.268a8.24 8.24 0 00-.689-1.191l.6-.504a.75.75 0 10-.964-1.149l-.6.504a8.3 8.3 0 00-1.054-.885l.391-.678a.75.75 0 10-1.299-.75l-.39.677a8.188 8.188 0 00-1.295-.471l.136-.77a.75.75 0 00-1.477-.26l-.136.77a8.364 8.364 0 00-1.377 0l-.136-.77a.75.75 0 10-1.477.26l.136.77c-.448.121-.88.28-1.294.47l-.39-.676a.75.75 0 00-1.3.75l.392.678a8.29 8.29 0 00-1.054.885l-.6-.504a.75.75 0 00-.965 1.149l.6.503a8.243 8.243 0 00-.689 1.192L3.8 8.217a.75.75 0 10-.513 1.41l.735.267a8.222 8.222 0 00-.238 1.355h-.783a.75.75 0 000 1.5h.783c.042.464.122.917.238 1.356l-.735.268a.75.75 0 10.513 1.41l.735-.268c.197.417.428.816.69 1.192l-.6.504a.75.75 0 10.963 1.149l.601-.505c.326.323.679.62 1.054.885l-.392.68a.75.75 0 101.3.75l.39-.679c.414.192.847.35 1.294.471l-.136.771a.75.75 0 101.477.26l.137-.772a8.376 8.376 0 001.376 0l.136.773a.75.75 0 101.477-.26l-.136-.772a8.19 8.19 0 001.294-.47l.391.677a.75.75 0 101.3-.75l-.393-.679a8.282 8.282 0 001.054-.885l.601.504a.75.75 0 10.964-1.15l-.6-.503a8.24 8.24 0 00.69-1.191l.735.268a.75.75 0 10.512-1.41l-.734-.268c.115-.438.195-.892.237-1.356h.784zm-2.657-3.06a6.744 6.744 0 00-1.19-2.053 6.784 6.784 0 00-1.82-1.51A6.704 6.704 0 0012 5.25a6.801 6.801 0 00-1.225.111 6.7 6.7 0 00-2.15.792 6.784 6.784 0 00-2.952 3.489.758.758 0 01-.036.099A6.74 6.74 0 005.251 12a6.739 6.739 0 003.355 5.835l.01.006.01.005a6.706 6.706 0 002.203.802c.007 0 .014.002.021.004a6.792 6.792 0 002.301 0l.022-.004a6.707 6.707 0 002.228-.816 6.781 6.781 0 001.762-1.483l.009-.01.009-.012a6.744 6.744 0 001.18-2.064c.253-.708.39-1.47.39-2.264a6.74 6.74 0 00-.408-2.308z"
                clip-rule="evenodd"
              />
            </svg>

            <div class="items-start pr-12">
              <caption>
                Motor
              </caption>
            </div>
          </a>
        </div>
        <div>
          <a
            href="/pelanggan"
            class="flex items-center space-x-2 font-medium px-2 py-2 text-slate-700 rounded-lg hover:bg-red-500 hover:text-white"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-6 h-6"
            >
              <path
                d="M4.5 6.375a4.125 4.125 0 118.25 0 4.125 4.125 0 01-8.25 0zM14.25 8.625a3.375 3.375 0 116.75 0 3.375 3.375 0 01-6.75 0zM1.5 19.125a7.125 7.125 0 0114.25 0v.003l-.001.119a.75.75 0 01-.363.63 13.067 13.067 0 01-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 01-.364-.63l-.001-.122zM17.25 19.128l-.001.144a2.25 2.25 0 01-.233.96 10.088 10.088 0 005.06-1.01.75.75 0 00.42-.643 4.875 4.875 0 00-6.957-4.611 8.586 8.586 0 011.71 5.157v.003z"
              />
            </svg>

            <div class="items-start pr-12">
              <caption>
                Pelanggan
              </caption>
            </div>
          </a>
        </div>

        <div>
          <a
            href="/antrian"
            class="flex items-center space-x-2 font-medium px-2 py-2 text-slate-700 rounded-lg hover:bg-red-500 hover:text-white"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-6 h-6"
            >
              <path
                d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a1.875 1.875 0 01-1.875-1.875V5.25A3.75 3.75 0 009 1.5H5.625z"
              />
              <path
                d="M12.971 1.816A5.23 5.23 0 0114.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 013.434 1.279 9.768 9.768 0 00-6.963-6.963z"
              />
            </svg>

            <div class="items-start pr-12">
              <caption>
                Antrian
              </caption>
            </div>
          </a>
        </div>

        <div>
          <a
            href="/"
            class="flex items-center space-x-2 font-medium px-2 py-2 text-slate-700 rounded-lg hover:bg-red-500 hover:text-white"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="w-6 h-6"
            >
              <path
                fill-rule="evenodd"
                d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z"
                clip-rule="evenodd"
              />
            </svg>

            <div class="items-start pr-12">
              <caption>
                Keluar
              </caption>
            </div>
          </a>
        </div>
      </nav>
      <div>
        <div class="relative overflow-x-auto shadow-md sm:rounded-lg mt-2 mr-2">
          <table class="w-full text-sm text-left text-gray-500" id="dataTable">
            <caption
              class="p-5 text-lg font-semibold text-left text-gray-900 bg-white dark:text-white dark:bg-gray-800"
            >
              <div class="flex items-center">
                <div class="grow">
                  <%= title %>
                  <p
                    class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400"
                  >
                    <%= desc %>
                  </p>
                </div>
                <div class="mr-2">
                  <button id="exportToExcel">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      fill="currentColor"
                      class="w-8 h-8"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M19.5 21a3 3 0 003-3V9a3 3 0 00-3-3h-5.379a.75.75 0 01-.53-.22L11.47 3.66A2.25 2.25 0 009.879 3H4.5a3 3 0 00-3 3v12a3 3 0 003 3h15zm-6.75-10.5a.75.75 0 00-1.5 0v4.19l-1.72-1.72a.75.75 0 00-1.06 1.06l3 3a.75.75 0 001.06 0l3-3a.75.75 0 10-1.06-1.06l-1.72 1.72V10.5z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </button>
                </div>
              </div>
            </caption>
            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
              <tr>
                <th scope="col" class="px-6 py-3">Kode Antrian</th>
                <th scope="col" class="px-6 py-3">Nomor Polisi</th>
                <th scope="col" class="px-6 py-3">Nama Bengkel</th>
                <th scope="col" class="px-6 py-3">Layanan</th>
                <th scope="col" class="px-6 py-3">Keluhan</th>
                <th scope="col" class="px-6 py-3">Tanggal Booking</th>
                <th scope="col" class="px-6 py-3">Waktu Booking</th>
                <th scope="col" class="px-6 py-3">Transaksi</th>
                <th scope="col" class="px-6 py-3 sr-only">Menu</th>
              </tr>
            </thead>
            <tbody class="">
              <% for (let list of antrian) {%>
              <tr class="bg-white border-b">
                <th
                  scope="row"
                  class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap"
                >
                  <%= list.id_antrian %>
                </th>
                <td class="px-6 py-4"><%= list.nopolisi %></td>
                <td class="px-6 py-4"><%= list.nama_bengkel %></td>
                <td class="px-6 py-4"><%= list.nama_layanan %></td>
                <td class="px-6 py-4"><%= list.keluhan%></td>
                <td class="px-6 py-4"><%= list.tanggal_booking %></td>
                <td class="px-6 py-4"><%= list.waktu_booking %></td>
                <td class="px-6 py-4"><%= list.waktu_transaksi %></td>
                <td class="px-6 py-4">
                  <div class="flex">
                    <a href="/antrian-ubah/<%= list.id_antrian %>">
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24"
                        fill="currentColor"
                        class="w-6 h-6"
                      >
                        <path
                          d="M21.731 2.269a2.625 2.625 0 00-3.712 0l-1.157 1.157 3.712 3.712 1.157-1.157a2.625 2.625 0 000-3.712zM19.513 8.199l-3.712-3.712-8.4 8.4a5.25 5.25 0 00-1.32 2.214l-.8 2.685a.75.75 0 00.933.933l2.685-.8a5.25 5.25 0 002.214-1.32l8.4-8.4z"
                        />
                        <path
                          d="M5.25 5.25a3 3 0 00-3 3v10.5a3 3 0 003 3h10.5a3 3 0 003-3V13.5a.75.75 0 00-1.5 0v5.25a1.5 1.5 0 01-1.5 1.5H5.25a1.5 1.5 0 01-1.5-1.5V8.25a1.5 1.5 0 011.5-1.5h5.25a.75.75 0 000-1.5H5.25z"
                        />
                      </svg>
                    </a>

                    <form
                      action="/antrian/<%= list.id_antrian %>"
                      method="POST"
                    >
                      <input type="hidden" name="_method" value="DELETE" />
                      <button
                        type="submit"
                        onclick="return confirm('Konfirmasi Hapus Data')"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          fill="currentColor"
                          class="w-6 h-6"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M16.5 4.478v.227a48.816 48.816 0 013.878.512.75.75 0 11-.256 1.478l-.209-.035-1.005 13.07a3 3 0 01-2.991 2.77H8.084a3 3 0 01-2.991-2.77L4.087 6.66l-.209.035a.75.75 0 01-.256-1.478A48.567 48.567 0 017.5 4.705v-.227c0-1.564 1.213-2.9 2.816-2.951a52.662 52.662 0 013.369 0c1.603.051 2.815 1.387 2.815 2.951zm-6.136-1.452a51.196 51.196 0 013.273 0C14.39 3.05 15 3.684 15 4.478v.113a49.488 49.488 0 00-6 0v-.113c0-.794.609-1.428 1.364-1.452zm-.355 5.945a.75.75 0 10-1.5.058l.347 9a.75.75 0 101.499-.058l-.346-9zm5.48.058a.75.75 0 10-1.498-.058l-.347 9a.75.75 0 001.5.058l.345-9z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const hapusButtons = document.querySelectorAll('.tombol-hapus')

        hapusButtons.forEach((button) => {
          button.addEventListener('click', (event) => {
            const id = event.target.dataset.id
            hapusData(id)
          })
        })
      })
      function hapusData(id) {
        fetch(`/antrian/${id}`, {
          method: 'DELETE',
        })
          .then((response) => response.json())
          .then((data) => {
            location.reload()
          })
          .catch((error) => {
            console.error('Error:', error)
            return error
          })
      }

      document
        .getElementById('exportToExcel')
        .addEventListener('click', function () {
          const table = document.getElementById('dataTable')
          const theadRow = table.querySelector('thead tr')
          const tbodyRows = table.querySelectorAll('tbody tr')

          const data = []
          const headers = []

          // Ambil data dari <th> (judul kolom)
          for (let i = 0; i < theadRow.cells.length; i++) {
            headers.push(theadRow.cells[i].innerText)
          }
          data.push(headers)

          // Ambil data dari <td> (isi tabel)
          for (let i = 0; i < tbodyRows.length; i++) {
            const row = tbodyRows[i]
            const rowData = []
            for (let j = 0; j < row.cells.length; j++) {
              rowData.push(row.cells[j].innerText)
            }
            data.push(rowData)
          }

          // Buat objek workbook baru
          const wb = XLSX.utils.book_new()
          // Buat sheet baru dengan nama "Data Antrian"
          const ws = XLSX.utils.aoa_to_sheet(data)
          XLSX.utils.book_append_sheet(wb, ws, 'Data Antrian')

          // Convert workbook menjadi format yang sesuai untuk file Excel
          const excelBuffer = XLSX.write(wb, {
            bookType: 'xlsx',
            type: 'array',
          })

          // Panggil fungsi untuk mentransfer data Excel sebagai file ke sisi klien (browser)
          const blob = new Blob([excelBuffer], {
            type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
          })
          const fileName = 'data-antrian.xlsx'

          if (navigator.msSaveBlob) {
            // Untuk Internet Explorer
            navigator.msSaveBlob(blob, fileName)
          } else {
            // Untuk browser modern
            const url = window.URL.createObjectURL(blob)
            const a = document.createElement('a')
            a.href = url
            a.download = fileName
            document.body.appendChild(a)
            a.click()
            document.body.removeChild(a)
            window.URL.revokeObjectURL(url)
          }

          console.log(`Tabel berhasil ditransfer ke file Excel: ${fileName}`)
        })
    </script>
  </body>
</html>
